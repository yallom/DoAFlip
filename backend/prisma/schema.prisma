// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
    provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Enums
enum Gender {
  Masculine
  Feminine
}

enum Allergies{
  peanuts
  lactose
  soy
  seafood
}

enum Goal {
  weight_loss
  muscle_gain
  maintenance
}

enum MealType {
  breakfast
  lunch
  dinner
  snack
}

enum FoodCategory {
  protein
  carbohidrate
  vegetable
  fruit
  fat
  dairy
  grains
}

// Models
model User {
  id                    String              @id @default(uuid())
  email                 String              @unique
  hashPassword          String
  name                  String
  age       Int
  height             Int
  weight               Float
  gender                Gender
  alergies          Allergies[]
  goal              Goal
  created_at            DateTime            @default(now())
  updated_at            DateTime            @updatedAt

  // Relacionamentos
  meal_plan        MealPlan[]

  @@map("users")
}

model Meal {
  id                    String              @id @default(uuid())
  mealPlan_id     String
  type                  MealType
  date                  DateTime
  created_at          DateTime            @default(now())
  total_calories       Float               @default(0)

  // Relacionamentos
  meal_plan        MealPlan      @relation(fields: [mealPlan_id], references: [id], onDelete: Cascade)
  recipes              Recipe[]

  @@map("meals")
}

model MealPlan {
  id                    String              @id @default(uuid())
  user_id         String
  name                  String
  start_date           DateTime
  end_date              DateTime?
  calorie_goal         Int
  notes           String?

  // Relacionamentos
  user            User          @relation(fields: [user_id], references: [id], onDelete: Cascade)
  meals             Meal[]

  @@map("meal_plans")
}

model Food {
  id                       String                   @id @default(uuid())
  name                     String
  normalized_name         String
  category                FoodCategory
  vit_c                   Float
  vit_b11                 Float
  sodium                   Float
  calcium                 Float
  iron                   Float
  carbs                   Float
  fat                 Float
  fiber                   Float
  protein                 Float
  sugar                   Float
  calories                 Float
  health_score            Float


  // Relacionamentos
  recipe_ingredients     RecipeIngredient[]
  replacement_origins     FoodReplacement[]   @relation("AlimentoOrigem")
  replacement_replacements FoodReplacement[]   @relation("AlimentoSubstituto")

  @@map("foods")
}

model RecipeIngredient {
  id                       String                   @id @default(uuid())  
  recipe_id               String
  food_id              String
  quantity             Float

  // Relacionamentos
  recipe                  Recipe                  @relation(fields: [recipe_id], references: [id], onDelete: Cascade)
  food                 Food                 @relation(fields: [food_id], references: [id], onDelete: Cascade)
  replacements            FoodReplacement[]

  @@unique([recipe_id, food_id])
  @@map("recipe_ingredients")
}

model FoodReplacement {
  id                     String              @id @default(uuid())
  recipe_ingredient_id String
  original_food_id     String
  replacement_food_id String
  quantity           Float
  similarity_score     Float
  justification           String?
  reason                 String?

  // Relacionamentos
  recipe_ingredient    RecipeIngredient  @relation(fields: [recipe_ingredient_id], references: [id], onDelete: Cascade)
  original_food        Food            @relation("AlimentoOrigem", fields: [original_food_id], references: [id], onDelete: Cascade)
  replacement_food    Food            @relation("AlimentoSubstituto", fields: [replacement_food_id], references: [id], onDelete: Cascade)

  @@map("food_replacements")
}

model Recipe {
  id                    String                @id @default(uuid())
  name                  String
  description             String?
  portions               Int
  prep_time         Int
  total_calories       Int
  meal_id           String?

  // Relacionamentos
  ingredients          RecipeIngredient[]
  meal              Meal?             @relation(fields: [meal_id], references: [id], onDelete: Cascade)

  @@map("recipes")
}